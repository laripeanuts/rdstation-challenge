#!/usr/bin/env sh

# Carrega o ambiente do shell (Ãºtil para nvm, etc.)
export PATH="$HOME/.yarn/bin:$HOME/.config/yarn/global/node_modules/.bin:$PATH"

# Verifica se hÃ¡ arquivos do frontend sendo commitados
staged_files=$(git diff --cached --name-only --diff-filter=ACM | grep -E '^frontend/' || true)

if [ -n "$staged_files" ]; then
  echo "ğŸ” Executando lint nos arquivos do frontend..."

  # Verifica se yarn estÃ¡ disponÃ­vel
  if ! command -v yarn >/dev/null 2>&1; then
    echo "âŒ Erro: yarn nÃ£o encontrado no PATH"
    exit 1
  fi

  # Executa o lint e captura o cÃ³digo de saÃ­da
  if yarn --cwd frontend lint --max-warnings 0; then
    echo "âœ… Lint passou com sucesso!"
  else
    echo ""
    echo "âŒ Lint falhou! Por favor, corrija os erros antes de commitar."
    echo "ğŸ’¡ VocÃª pode executar 'yarn --cwd frontend lint:fix' para corrigir automaticamente alguns erros."
    exit 1
  fi
fi
